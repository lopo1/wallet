# 助记词重复检查功能

## 概述
为了防止用户重复导入相同的助记词，我们实现了助记词重复检查功能。该功能通过比较生成的地址来判断助记词是否已经导入过。

## 实现原理

### 检查机制
1. **地址比较**: 使用相同的助记词会生成相同的地址，因此通过比较以太坊网络的第一个地址来判断助记词是否重复
2. **实时检查**: 在用户输入助记词时进行实时检查，提供即时反馈
3. **导入阻止**: 当检测到重复助记词时，禁用导入按钮并显示警告信息

### 技术实现

#### 1. 钱包提供者新增方法 (`lib/providers/wallet_provider.dart`)

```dart
/// 检查助记词是否已经导入过
Future<bool> isMnemonicAlreadyImported(String mnemonic) async {
  // 生成测试地址并与现有钱包地址比较
}

/// 根据助记词获取钱包名称
Future<String?> getWalletNameByMnemonic(String mnemonic) async {
  // 返回使用该助记词的钱包名称
}
```

#### 2. 导入钱包方法增强
- 在导入前检查助记词是否已存在
- 如果存在，抛出包含现有钱包名称的异常

#### 3. UI界面增强 (`lib/screens/import_wallet_screen.dart`)
- 添加实时助记词检查
- 显示检查状态（加载指示器）
- 显示警告信息
- 禁用重复助记词的导入按钮

## 功能特性

### ✅ 实时检查
- 用户输入助记词时自动检查
- 500ms延迟避免频繁调用
- 显示检查进度指示器

### ✅ 智能提示
- 检测到重复时显示警告信息
- 显示已存在的钱包名称
- 橙色警告样式，清晰易识别

### ✅ 导入阻止
- 检测到重复助记词时禁用导入按钮
- 防止用户误操作
- 保持数据一致性

### ✅ 用户体验
- 友好的错误提示
- 清晰的视觉反馈
- 不影响正常导入流程

## 使用场景

### 场景1：首次导入
```
用户输入新的助记词 → 检查通过 → 允许导入 → 成功创建钱包
```

### 场景2：重复导入
```
用户输入已存在的助记词 → 检查失败 → 显示警告 → 禁用导入按钮
```

### 场景3：错误助记词
```
用户输入无效助记词 → 表单验证失败 → 显示验证错误
```

## 技术细节

### 地址生成逻辑
- 使用以太坊网络作为唯一标识符
- 生成助记词的第一个地址（索引0）
- 与所有现有钱包的以太坊地址进行比较

### 性能优化
- 延迟检查避免频繁API调用
- 异步处理不阻塞UI
- 错误处理确保稳定性

### 安全考虑
- 不存储明文助记词
- 仅比较生成的地址
- 保护用户隐私

## 代码示例

### 检查助记词重复
```dart
final walletProvider = Provider.of<WalletProvider>(context, listen: false);
final isAlreadyImported = await walletProvider.isMnemonicAlreadyImported(mnemonic);

if (isAlreadyImported) {
  final existingWalletName = await walletProvider.getWalletNameByMnemonic(mnemonic);
  // 显示警告信息
}
```

### UI状态管理
```dart
// 状态变量
bool _isCheckingMnemonic = false;
String? _mnemonicWarning;

// 实时检查
onChanged: (value) {
  Future.delayed(const Duration(milliseconds: 500), () {
    if (_mnemonicController.text == value) {
      _checkMnemonicDuplication();
    }
  });
}
```

## 错误处理

### 网络错误
- 检查失败时不阻止导入
- 显示友好的错误信息
- 允许用户重试

### 验证错误
- 无效助记词的表单验证
- 清晰的错误提示
- 引导用户输入正确格式

## 测试建议

### 手动测试步骤
1. 创建一个新钱包
2. 记录生成的助记词
3. 尝试用相同助记词再次导入
4. 验证是否显示重复警告
5. 确认导入按钮被禁用

### 边界情况测试
- 空助记词输入
- 无效助记词格式
- 网络连接问题
- 多个钱包存在的情况

## 未来改进

### 可能的增强功能
1. **批量检查**: 支持检查多个助记词
2. **历史记录**: 显示导入历史和重复尝试
3. **智能建议**: 建议相似但不重复的钱包名称
4. **导出功能**: 允许导出现有钱包的助记词进行比较

### 性能优化
1. **缓存机制**: 缓存已检查的助记词结果
2. **并行检查**: 同时检查多个网络的地址
3. **增量检查**: 只检查新增的钱包

## 总结

助记词重复检查功能有效防止了用户重复导入相同的助记词，提供了良好的用户体验和数据一致性保障。通过实时检查、智能提示和导入阻止等机制，确保了钱包管理的安全性和可靠性。