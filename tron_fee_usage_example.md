# TRON è´¹ç”¨åŠŸèƒ½ä½¿ç”¨ç¤ºä¾‹

## 1. åœ¨å‘é€ç•Œé¢æŸ¥çœ‹è´¹ç”¨

### TRX è½¬è´¦

å½“ç”¨æˆ·åœ¨å‘é€ç•Œé¢è¾“å…¥æ”¶æ¬¾åœ°å€åï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ˜¾ç¤ºè¯¦ç»†çš„è´¹ç”¨ä¿¡æ¯ï¼š

```
æ‰‹ç»­è´¹                    ğŸ”„ 10såæ›´æ–°

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ€»è´¹ç”¨                  0.000268 TRX â”‚
â”‚                         $0.0000      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¸¦å®½                                â”‚
â”‚ ä½¿ç”¨å…è´¹èµ„æº                         â”‚
â”‚ 268 / 5000                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å‘æœªæ¿€æ´»åœ°å€è½¬è´¦

```
æ‰‹ç»­è´¹                    ğŸ”„ 10såæ›´æ–°

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ€»è´¹ç”¨                  1.000268 TRX â”‚
â”‚                         $0.1000      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¸¦å®½                                â”‚
â”‚ ä½¿ç”¨å…è´¹èµ„æº                         â”‚
â”‚ 268 / 5000                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âš ï¸ æ¿€æ´»æ–°è´¦æˆ·                        â”‚
â”‚ ç›®æ ‡åœ°å€æœªæ¿€æ´»ï¼Œéœ€é¢å¤–æ¶ˆè€— 1.0 TRX    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### TRC20 è½¬è´¦ï¼ˆèƒ½é‡ä¸è¶³ï¼‰

```
æ‰‹ç»­è´¹                    ğŸ”„ 10såæ›´æ–°

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ€»è´¹ç”¨                 13.745000 TRX â”‚
â”‚                         $1.3745      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¸¦å®½                                â”‚
â”‚ ä½¿ç”¨å…è´¹èµ„æº                         â”‚
â”‚ 345 / 5000                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ èƒ½é‡                                â”‚
â”‚ æ¶ˆè€— 13.400000 TRX                  â”‚
â”‚ 31895 / 0                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2. ä»£ç é›†æˆç¤ºä¾‹

### åœ¨ WalletProvider ä¸­è·å–è´¹ç”¨ä¼°ç®—

```dart
// TRX è½¬è´¦è´¹ç”¨ä¼°ç®—
final walletProvider = Provider.of<WalletProvider>(context, listen: false);

final trxFee = await walletProvider.getNetworkFeeEstimate(
  'tron',
  amount: 10.0,
  toAddress: 'TYourRecipientAddress...',
);

print('TRX è½¬è´¦è´¹ç”¨: $trxFee TRX');
```

### TRC20 è½¬è´¦è´¹ç”¨ä¼°ç®—

```dart
// TRC20 è½¬è´¦è´¹ç”¨ä¼°ç®—
final trc20FeeEstimate = await walletProvider.getTrc20FeeEstimate(
  contractAddress: 'TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t', // USDT
  toAddress: 'TYourRecipientAddress...',
  amount: 100.0,
  decimals: 6,
);

print('æ€»è´¹ç”¨: ${trc20FeeEstimate.totalFeeTrx} TRX');
print('å¸¦å®½è´¹ç”¨: ${trc20FeeEstimate.bandwidthFeeTrx} TRX');
print('èƒ½é‡è´¹ç”¨: ${trc20FeeEstimate.energyFeeTrx} TRX');
print('æ¿€æ´»è´¹ç”¨: ${trc20FeeEstimate.activationFeeTrx} TRX');
print('éœ€è¦æ¿€æ´»: ${trc20FeeEstimate.needsActivation}');
```

### ç›´æ¥ä½¿ç”¨ TronFeeService

```dart
import 'package:flutter_wallet/services/tron_fee_service.dart';

// æ£€æŸ¥åœ°å€æ˜¯å¦æ¿€æ´»
final isActivated = await TronFeeService.isAccountActivated(
  address: 'TYourAddress...',
  tronRpcBaseUrl: 'https://nile.trongrid.io',
);

print('åœ°å€å·²æ¿€æ´»: $isActivated');

// è·å–è´¦æˆ·èµ„æº
final resources = await TronFeeService.getAccountResources(
  address: 'TYourAddress...',
  tronRpcBaseUrl: 'https://nile.trongrid.io',
);

print('å¯ç”¨å¸¦å®½: ${resources['availableBandwidth']}');
print('å¯ç”¨èƒ½é‡: ${resources['availableEnergy']}');

// TRX è½¬è´¦è´¹ç”¨ä¼°ç®—
final feeEstimate = await TronFeeService.estimateTrxTransferFee(
  fromAddress: 'TYourFromAddress...',
  toAddress: 'TYourToAddress...',
  amountTRX: 10.0,
  tronRpcBaseUrl: 'https://nile.trongrid.io',
);

print('è´¹ç”¨è¯¦æƒ…:');
print(feeEstimate.getDetailedDescription());
```

## 3. è´¹ç”¨ä¼°ç®—ç»“æœå¯¹è±¡

### TronFeeEstimate å±æ€§

```dart
class TronFeeEstimate {
  final int bandwidthRequired;      // éœ€è¦çš„å¸¦å®½
  final int bandwidthAvailable;     // å¯ç”¨çš„å¸¦å®½
  final double bandwidthFeeTrx;     // å¸¦å®½è´¹ç”¨ï¼ˆTRXï¼‰
  final double activationFeeTrx;    // æ¿€æ´»è´¹ç”¨ï¼ˆTRXï¼‰
  final double totalFeeTrx;         // æ€»è´¹ç”¨ï¼ˆTRXï¼‰
  final bool isToAddressActivated;  // ç›®æ ‡åœ°å€æ˜¯å¦å·²æ¿€æ´»
  final int energyRequired;         // éœ€è¦çš„èƒ½é‡
  final int energyAvailable;        // å¯ç”¨çš„èƒ½é‡
  final double energyFeeTrx;        // èƒ½é‡è´¹ç”¨ï¼ˆTRXï¼‰
  
  // è¾…åŠ©æ–¹æ³•
  String getDetailedDescription();  // è·å–è¯¦ç»†æè¿°
  bool get needsActivation;         // æ˜¯å¦éœ€è¦æ¿€æ´»
  bool get needsBandwidthFee;       // æ˜¯å¦éœ€è¦æ”¯ä»˜å¸¦å®½è´¹ç”¨
  bool get needsEnergyFee;          // æ˜¯å¦éœ€è¦æ”¯ä»˜èƒ½é‡è´¹ç”¨
}
```

## 4. å¸¸è§åœºæ™¯å¤„ç†

### åœºæ™¯ 1ï¼šç”¨æˆ·æœ‰è¶³å¤Ÿçš„å…è´¹å¸¦å®½

```dart
// ç”¨æˆ·æ¯æ—¥æœ‰ 5000 ç‚¹å…è´¹å¸¦å®½
// TRX è½¬è´¦éœ€è¦çº¦ 268 ç‚¹å¸¦å®½
// ç»“æœï¼šä½¿ç”¨å…è´¹å¸¦å®½ï¼Œæ— éœ€æ”¯ä»˜è´¹ç”¨

final estimate = await TronFeeService.estimateTrxTransferFee(...);
// estimate.bandwidthFeeTrx == 0.0
// estimate.totalFeeTrx == 0.0 (å‡è®¾ç›®æ ‡åœ°å€å·²æ¿€æ´»)
```

### åœºæ™¯ 2ï¼šç”¨æˆ·å¸¦å®½ä¸è¶³

```dart
// ç”¨æˆ·å·²ç”¨å®Œå…è´¹å¸¦å®½
// éœ€è¦æ”¯ä»˜å¸¦å®½è´¹ç”¨

final estimate = await TronFeeService.estimateTrxTransferFee(...);
// estimate.bandwidthFeeTrx == 0.268 TRX (268 Ã— 0.001)
// estimate.totalFeeTrx == 0.268 TRX
```

### åœºæ™¯ 3ï¼šå‘æœªæ¿€æ´»åœ°å€è½¬è´¦

```dart
// ç›®æ ‡åœ°å€ä»æœªæ¥æ”¶è¿‡ä»»ä½•èµ„äº§
// éœ€è¦æ”¯ä»˜æ¿€æ´»è´¹ç”¨

final estimate = await TronFeeService.estimateTrxTransferFee(...);
// estimate.activationFeeTrx == 1.0 TRX
// estimate.totalFeeTrx == 1.268 TRX (å¸¦å®½ + æ¿€æ´»)
```

### åœºæ™¯ 4ï¼šTRC20 è½¬è´¦ï¼ˆæ— èƒ½é‡ï¼‰

```dart
// ç”¨æˆ·æ²¡æœ‰è´¨æŠ¼ TRX è·å–èƒ½é‡
// éœ€è¦æ”¯ä»˜é«˜é¢èƒ½é‡è´¹ç”¨

final estimate = await TronFeeService.estimateTrc20TransferFee(...);
// estimate.energyFeeTrx == 13.4 TRX (31895 Ã— 0.00042)
// estimate.bandwidthFeeTrx == 0.345 TRX
// estimate.totalFeeTrx == 13.745 TRX
```

### åœºæ™¯ 5ï¼šTRC20 è½¬è´¦ï¼ˆæœ‰èƒ½é‡ï¼‰

```dart
// ç”¨æˆ·é€šè¿‡è´¨æŠ¼ TRX è·å¾—äº†è¶³å¤Ÿçš„èƒ½é‡
// åªéœ€æ”¯ä»˜å¸¦å®½è´¹ç”¨

final estimate = await TronFeeService.estimateTrc20TransferFee(...);
// estimate.energyFeeTrx == 0.0 TRX (ä½¿ç”¨è´¨æŠ¼èƒ½é‡)
// estimate.bandwidthFeeTrx == 0.0 TRX (ä½¿ç”¨å…è´¹å¸¦å®½)
// estimate.totalFeeTrx == 0.0 TRX
```

## 5. é”™è¯¯å¤„ç†

### ç½‘ç»œé”™è¯¯

```dart
try {
  final estimate = await TronFeeService.estimateTrxTransferFee(...);
  // ä½¿ç”¨ä¼°ç®—ç»“æœ
} catch (e) {
  print('è´¹ç”¨ä¼°ç®—å¤±è´¥: $e');
  // ä½¿ç”¨é»˜è®¤è´¹ç”¨
  final defaultFee = 0.1; // TRX
}
```

### RPC ä¸å¯ç”¨

```dart
// WalletProvider ä¼šè‡ªåŠ¨å°è¯•å¤‡ç”¨ RPC
final estimate = await walletProvider.getNetworkFeeEstimate(
  'tron',
  amount: 10.0,
  toAddress: 'TYourAddress...',
);
// å¦‚æœæ‰€æœ‰ RPC éƒ½å¤±è´¥ï¼Œè¿”å›é»˜è®¤å€¼ 0.1 TRX
```

## 6. æ€§èƒ½ä¼˜åŒ–å»ºè®®

### ç¼“å­˜è´¹ç”¨ä¼°ç®—ç»“æœ

```dart
// åœ¨å‘é€ç•Œé¢ä¸­
TronFeeEstimate? _cachedFeeEstimate;
String? _lastToAddress;

Future<void> _loadFee(String toAddress) async {
  // å¦‚æœåœ°å€æ²¡å˜ï¼Œä½¿ç”¨ç¼“å­˜
  if (toAddress == _lastToAddress && _cachedFeeEstimate != null) {
    return;
  }
  
  // é‡æ–°ä¼°ç®—
  _cachedFeeEstimate = await TronFeeService.estimateTrxTransferFee(...);
  _lastToAddress = toAddress;
}
```

### é˜²æŠ–åŠ¨

```dart
// ç”¨æˆ·è¾“å…¥åœ°å€æ—¶ï¼Œå»¶è¿ŸæŸ¥è¯¢
Timer? _debounceTimer;

void _onAddressChanged(String address) {
  _debounceTimer?.cancel();
  _debounceTimer = Timer(Duration(milliseconds: 500), () {
    _loadFee(address);
  });
}
```

## 7. UI é›†æˆæç¤º

### æ˜¾ç¤ºåŠ è½½çŠ¶æ€

```dart
bool _isLoadingFee = false;

Widget build(BuildContext context) {
  return Column(
    children: [
      if (_isLoadingFee)
        CircularProgressIndicator()
      else if (_tronFeeEstimate != null)
        _buildTronFeeDetails()
      else
        Text('è¯·è¾“å…¥æ”¶æ¬¾åœ°å€ä»¥æŸ¥çœ‹è´¹ç”¨'),
    ],
  );
}
```

### è­¦å‘Šç”¨æˆ·é«˜é¢è´¹ç”¨

```dart
if (_tronFeeEstimate != null && _tronFeeEstimate!.totalFeeTrx > 10.0) {
  showDialog(
    context: context,
    builder: (context) => AlertDialog(
      title: Text('é«˜é¢æ‰‹ç»­è´¹è­¦å‘Š'),
      content: Text(
        'æ­¤æ¬¡è½¬è´¦éœ€è¦æ”¯ä»˜ ${_tronFeeEstimate!.totalFeeTrx.toStringAsFixed(2)} TRX çš„æ‰‹ç»­è´¹ã€‚\n\n'
        'å»ºè®®ï¼šè´¨æŠ¼ TRX ä»¥è·å–èƒ½é‡ï¼Œå¯å¤§å¹…é™ä½ TRC20 è½¬è´¦è´¹ç”¨ã€‚'
      ),
      actions: [
        TextButton(
          onPressed: () => Navigator.pop(context),
          child: Text('æˆ‘çŸ¥é“äº†'),
        ),
      ],
    ),
  );
}
```

## 8. æµ‹è¯•ç”¨ä¾‹

### å•å…ƒæµ‹è¯•ç¤ºä¾‹

```dart
import 'package:flutter_test/flutter_test.dart';
import 'package:flutter_wallet/services/tron_fee_service.dart';

void main() {
  group('TronFeeService', () {
    test('æ£€æŸ¥å·²æ¿€æ´»åœ°å€', () async {
      final isActivated = await TronFeeService.isAccountActivated(
        address: 'TKnownActivatedAddress...',
        tronRpcBaseUrl: 'https://nile.trongrid.io',
      );
      expect(isActivated, true);
    });
    
    test('æ£€æŸ¥æœªæ¿€æ´»åœ°å€', () async {
      final isActivated = await TronFeeService.isAccountActivated(
        address: 'TNewAddress...',
        tronRpcBaseUrl: 'https://nile.trongrid.io',
      );
      expect(isActivated, false);
    });
    
    test('TRX è½¬è´¦è´¹ç”¨ä¼°ç®—', () async {
      final estimate = await TronFeeService.estimateTrxTransferFee(
        fromAddress: 'TYourFromAddress...',
        toAddress: 'TYourToAddress...',
        amountTRX: 10.0,
        tronRpcBaseUrl: 'https://nile.trongrid.io',
      );
      
      expect(estimate.bandwidthRequired, 268);
      expect(estimate.totalFeeTrx, greaterThanOrEqualTo(0.0));
    });
  });
}
```

## 9. å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆ TRC20 è½¬è´¦è´¹ç”¨è¿™ä¹ˆé«˜ï¼Ÿ
A: TRC20 è½¬è´¦éœ€è¦æ¶ˆè€—èƒ½é‡ã€‚å¦‚æœæ²¡æœ‰è´¨æŠ¼ TRX è·å–èƒ½é‡ï¼Œéœ€è¦æŒ‰å¸‚åœºä»·æ ¼æ”¯ä»˜ï¼Œçº¦ 13.4 TRXã€‚å»ºè®®è´¨æŠ¼ TRX ä»¥è·å–å…è´¹èƒ½é‡ã€‚

### Q: å¦‚ä½•é™ä½ TRC20 è½¬è´¦è´¹ç”¨ï¼Ÿ
A: 
1. è´¨æŠ¼ TRX è·å–èƒ½é‡
2. ä½¿ç”¨æœ‰èƒ½é‡çš„åœ°å€å‘é€
3. é€‰æ‹©ç½‘ç»œä¸æ‹¥å µçš„æ—¶é—´è½¬è´¦

### Q: æ¿€æ´»è´¹ç”¨æ˜¯ä»€ä¹ˆï¼Ÿ
A: TRON ç½‘ç»œè¦æ±‚æ¯ä¸ªåœ°å€åœ¨é¦–æ¬¡æ¥æ”¶èµ„äº§æ—¶éœ€è¦è¢«æ¿€æ´»ï¼Œæ¿€æ´»è´¹ç”¨ä¸º 1 TRXï¼Œç”±å‘é€æ–¹æ”¯ä»˜ã€‚

### Q: å…è´¹å¸¦å®½ä»€ä¹ˆæ—¶å€™é‡ç½®ï¼Ÿ
A: æ¯ä¸ªè´¦æˆ·æ¯æ—¥æœ‰ 5000 ç‚¹å…è´¹å¸¦å®½ï¼Œæ¯ 24 å°æ—¶é‡ç½®ä¸€æ¬¡ã€‚

### Q: è´¹ç”¨ä¼°ç®—å‡†ç¡®å—ï¼Ÿ
A: è´¹ç”¨ä¼°ç®—åŸºäºå½“å‰ç½‘ç»œçŠ¶æ€ï¼Œå®é™…è´¹ç”¨å¯èƒ½ç•¥æœ‰å·®å¼‚ï¼ˆé€šå¸¸åœ¨ Â±5% èŒƒå›´å†…ï¼‰ã€‚
