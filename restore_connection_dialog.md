# 恢复DApp连接确认对话框

## 问题描述
在之前的修复中，为了解决连接失败问题，我们让连接过程变得过于自动化，导致用户无法看到：
1. 连接确认对话框
2. 地址选择界面
3. 网络选择选项

用户希望能够在连接DApp前看到这些确认界面。

## 解决方案

### 1. 恢复连接对话框显示
- 移除了自动跳过连接对话框的逻辑
- 现在每次访问DApp都会显示连接确认界面
- 区分新连接和已连接的DApp

### 2. 改进连接状态显示
- 如果DApp已连接，显示绿色的"已连接"状态
- 按钮文本根据连接状态变化：
  - 未连接：显示"连接"
  - 已连接：显示"继续访问"

### 3. 增强地址选择功能
- 在连接对话框中添加"选择其他地址"按钮
- 显示当前选中地址的名称（如果有自定义名称）
- 用户可以在连接前选择不同的钱包地址

### 4. 保持网络选择功能
- 用户可以在连接前选择不同的网络
- 显示当前网络状态和颜色标识

## 用户体验改进

### 连接新DApp时：
1. 显示"连接DApp"标题
2. 显示DApp信息和目标URL
3. 允许选择网络和地址
4. 点击"连接"按钮建立连接

### 访问已连接DApp时：
1. 显示"重新连接DApp"标题
2. 显示绿色的"已连接"状态提示
3. 仍然允许更改网络和地址设置
4. 点击"继续访问"按钮直接进入

## 技术实现

### 修改的关键逻辑：
1. **移除自动跳过逻辑**：
   ```dart
   // 注释掉自动导航逻辑，始终显示连接对话框让用户确认
   // if (isAlreadyConnected) {
   //   _actuallyNavigateToUrl(url);
   //   return;
   // }
   ```

2. **根据连接状态处理用户确认**：
   ```dart
   if (isAlreadyConnected) {
     // 直接导航
     _actuallyNavigateToUrl(url);
   } else {
     // 执行连接逻辑
     await _performDirectConnection(url, origin);
   }
   ```

3. **动态UI显示**：
   - 连接状态指示器
   - 动态按钮文本
   - 地址选择选项

## 预期效果

现在用户在访问DApp时会看到：
1. ✅ 连接确认对话框
2. ✅ 当前连接状态显示
3. ✅ 网络选择选项
4. ✅ 地址选择功能
5. ✅ 清晰的操作按钮

这样既保持了连接功能的正常工作，又给用户提供了完整的控制权和透明度。