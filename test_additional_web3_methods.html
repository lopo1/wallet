<!DOCTYPE html>
<html>
<head>
    <title>Web3æ–¹æ³•æ‰©å±•æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        button { padding: 10px 20px; margin: 5px; font-size: 14px; }
        .result { margin: 10px 0; padding: 10px; background: #f0f0f0; border-radius: 4px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .section h3 { margin-top: 0; color: #333; }
    </style>
</head>
<body>
    <h1>Web3æ–¹æ³•æ‰©å±•æµ‹è¯•</h1>
    
    <div class="section">
        <h3>åŸºç¡€æ–¹æ³•</h3>
        <button onclick="connectWallet()">è¿æ¥é’±åŒ…</button>
        <button onclick="getAccounts()">è·å–è´¦æˆ·</button>
        <button onclick="getChainId()">è·å–é“¾ID</button>
        <button onclick="getCapabilities()">è·å–é’±åŒ…èƒ½åŠ›</button>
    </div>

    <div class="section">
        <h3>åŒºå—é“¾æŸ¥è¯¢æ–¹æ³•</h3>
        <button onclick="getBlockNumber()">è·å–åŒºå—å·</button>
        <button onclick="getBalance()">è·å–ä½™é¢</button>
        <button onclick="getGasPrice()">è·å–Gasä»·æ ¼</button>
        <button onclick="getTransactionCount()">è·å–äº¤æ˜“è®¡æ•°</button>
    </div>

    <div class="section">
        <h3>åˆçº¦äº¤äº’æ–¹æ³•</h3>
        <button onclick="testEthCall()">æµ‹è¯•åˆçº¦è°ƒç”¨</button>
        <button onclick="testEstimateGas()">ä¼°ç®—Gas</button>
    </div>
    
    <div id="results"></div>

    <script>
        let currentAccount = null;

        function log(message, isError = false) {
            const div = document.createElement('div');
            div.className = 'result ' + (isError ? 'error' : 'success');
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}:</strong> ${message}`;
            document.getElementById('results').appendChild(div);
            console.log(message);
            
            // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
            div.scrollIntoView({ behavior: 'smooth' });
        }

        async function connectWallet() {
            try {
                log('ğŸ”„ è¿æ¥é’±åŒ…...');
                const accounts = await window.ethereum.request({ 
                    method: 'eth_requestAccounts' 
                });
                currentAccount = accounts[0];
                log(`âœ… è¿æ¥æˆåŠŸ! è´¦æˆ·: ${currentAccount}`);
            } catch (error) {
                log(`âŒ è¿æ¥å¤±è´¥: ${error.message}`, true);
            }
        }

        async function getAccounts() {
            try {
                const accounts = await window.ethereum.request({ 
                    method: 'eth_accounts' 
                });
                log(`âœ… è´¦æˆ·åˆ—è¡¨: ${JSON.stringify(accounts)}`);
            } catch (error) {
                log(`âŒ è·å–è´¦æˆ·å¤±è´¥: ${error.message}`, true);
            }
        }

        async function getChainId() {
            try {
                const chainId = await window.ethereum.request({ 
                    method: 'eth_chainId' 
                });
                log(`âœ… é“¾ID: ${chainId} (${parseInt(chainId, 16)})`);
            } catch (error) {
                log(`âŒ è·å–é“¾IDå¤±è´¥: ${error.message}`, true);
            }
        }

        async function getCapabilities() {
            try {
                log('ğŸ”„ è·å–é’±åŒ…èƒ½åŠ›...');
                const capabilities = await window.ethereum.request({ 
                    method: 'wallet_getCapabilities',
                    params: [currentAccount || '0x0000000000000000000000000000000000000000']
                });
                log(`âœ… é’±åŒ…èƒ½åŠ›: <pre>${JSON.stringify(capabilities, null, 2)}</pre>`);
            } catch (error) {
                log(`âŒ è·å–é’±åŒ…èƒ½åŠ›å¤±è´¥: ${error.message}`, true);
            }
        }

        async function getBlockNumber() {
            try {
                log('ğŸ”„ è·å–æœ€æ–°åŒºå—å·...');
                const blockNumber = await window.ethereum.request({ 
                    method: 'eth_blockNumber' 
                });
                log(`âœ… æœ€æ–°åŒºå—å·: ${blockNumber} (${parseInt(blockNumber, 16)})`);
            } catch (error) {
                log(`âŒ è·å–åŒºå—å·å¤±è´¥: ${error.message}`, true);
            }
        }

        async function getBalance() {
            try {
                if (!currentAccount) {
                    log('âŒ è¯·å…ˆè¿æ¥é’±åŒ…', true);
                    return;
                }
                
                log(`ğŸ”„ è·å–è´¦æˆ·ä½™é¢: ${currentAccount}...`);
                const balance = await window.ethereum.request({ 
                    method: 'eth_getBalance',
                    params: [currentAccount, 'latest']
                });
                const balanceInEth = parseInt(balance, 16) / Math.pow(10, 18);
                log(`âœ… è´¦æˆ·ä½™é¢: ${balance} wei (${balanceInEth.toFixed(6)} ETH)`);
            } catch (error) {
                log(`âŒ è·å–ä½™é¢å¤±è´¥: ${error.message}`, true);
            }
        }

        async function getGasPrice() {
            try {
                log('ğŸ”„ è·å–å½“å‰Gasä»·æ ¼...');
                const gasPrice = await window.ethereum.request({ 
                    method: 'eth_gasPrice' 
                });
                const gasPriceInGwei = parseInt(gasPrice, 16) / Math.pow(10, 9);
                log(`âœ… Gasä»·æ ¼: ${gasPrice} wei (${gasPriceInGwei.toFixed(2)} Gwei)`);
            } catch (error) {
                log(`âŒ è·å–Gasä»·æ ¼å¤±è´¥: ${error.message}`, true);
            }
        }

        async function getTransactionCount() {
            try {
                if (!currentAccount) {
                    log('âŒ è¯·å…ˆè¿æ¥é’±åŒ…', true);
                    return;
                }
                
                log(`ğŸ”„ è·å–äº¤æ˜“è®¡æ•°: ${currentAccount}...`);
                const txCount = await window.ethereum.request({ 
                    method: 'eth_getTransactionCount',
                    params: [currentAccount, 'latest']
                });
                log(`âœ… äº¤æ˜“è®¡æ•° (nonce): ${txCount} (${parseInt(txCount, 16)})`);
            } catch (error) {
                log(`âŒ è·å–äº¤æ˜“è®¡æ•°å¤±è´¥: ${error.message}`, true);
            }
        }

        async function testEthCall() {
            try {
                log('ğŸ”„ æµ‹è¯•åˆçº¦è°ƒç”¨ (è·å–ETHæ€»ä¾›åº”é‡)...');
                // è°ƒç”¨ä¸€ä¸ªç®€å•çš„åˆçº¦æ–¹æ³• - è·å–ETHæ€»ä¾›åº”é‡ (è¿™ä¸ªè°ƒç”¨åœ¨å¤§å¤šæ•°ç½‘ç»œä¸Šéƒ½ä¼šå¤±è´¥ï¼Œä½†å¯ä»¥æµ‹è¯•æ–¹æ³•æ˜¯å¦å·¥ä½œ)
                const result = await window.ethereum.request({ 
                    method: 'eth_call',
                    params: [{
                        to: '0x0000000000000000000000000000000000000000',
                        data: '0x18160ddd' // totalSupply() æ–¹æ³•ç­¾å
                    }, 'latest']
                });
                log(`âœ… åˆçº¦è°ƒç”¨ç»“æœ: ${result}`);
            } catch (error) {
                log(`âŒ åˆçº¦è°ƒç”¨å¤±è´¥: ${error.message}`, true);
            }
        }

        async function testEstimateGas() {
            try {
                if (!currentAccount) {
                    log('âŒ è¯·å…ˆè¿æ¥é’±åŒ…', true);
                    return;
                }
                
                log('ğŸ”„ ä¼°ç®—Gas (ç®€å•è½¬è´¦)...');
                const gasEstimate = await window.ethereum.request({ 
                    method: 'eth_estimateGas',
                    params: [{
                        from: currentAccount,
                        to: '0x0000000000000000000000000000000000000000',
                        value: '0x0' // 0 ETH
                    }]
                });
                log(`âœ… Gasä¼°ç®—: ${gasEstimate} (${parseInt(gasEstimate, 16)})`);
            } catch (error) {
                log(`âŒ Gasä¼°ç®—å¤±è´¥: ${error.message}`, true);
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿æ¥
        window.addEventListener('load', () => {
            setTimeout(() => {
                if (window.ethereum) {
                    log('âœ… æ£€æµ‹åˆ°Web3 Provider');
                    connectWallet();
                } else {
                    log('âŒ æœªæ£€æµ‹åˆ°Web3 Provider', true);
                }
            }, 1000);
        });
    </script>
</body>
</html>